import { Callout, Steps, Step } from "nextra-theme-docs";

# IPAMM

The `IPAMM` (Primary Automated Market Maker) interface defines the core functionality for the primary AMM pricing mechanism in the Gyroscope protocol. This contract is responsible for managing the redemption level, computing the reserve value, and handling minting and redemption operations.

The `IPAMM` interface is central to the Gyroscope protocol, as it encapsulates the key pricing and liquidity management logic. It provides a standardized way for other contracts in the system, such as the [Motherboard](/imotherboard) and [Reserve](/ireserve), to interact with the primary AMM.

## Key Functionality

The `IPAMM` interface exposes the following key functionalities:

### Minting
The `computeMintAmount` and `mint` functions handle the minting of Gyro dollars (GYD) tokens. The `computeMintAmount` function calculates the amount of GYD tokens to mint for a given USD input amount, while the `mint` function records this minting and returns the minted amount.

<Callout type="info">
The minting process involves adding the input USD value to the reserve, and minting the corresponding amount of GYD tokens. The specific pricing logic is implemented in the [PAMM](/pamm) contract, which implements the `IPAMM` interface.
</Callout>

### Redemption
The `computeRedeemAmount` and `redeem` functions handle the redemption of GYD tokens for USD. The `computeRedeemAmount` function calculates the USD value to be returned for a given amount of GYD tokens, while the `redeem` function records this redemption and returns the redeemed USD value.

<Callout type="info">
The redemption process involves burning the GYD tokens and withdrawing the corresponding USD value from the reserve. The specific pricing logic is again implemented in the [PAMM](/pamm) contract.
</Callout>

### System Parameters
The `setSystemParams` function allows the system parameters, such as the alpha bar, xu bar, theta bar, and outflow memory, to be updated. These parameters are crucial in determining the pricing behavior of the primary AMM.

<Callout type="warning">
Updating the system parameters should be done with great care, as it can significantly impact the behavior of the protocol. Any changes to these parameters should go through the [Governance](/governance) process.
</Callout>

## Usage

The `IPAMM` interface is primarily used by the [Motherboard](/imotherboard) contract to handle minting and redemption requests from users. The Motherboard contract is the main entry point for users to interact with the Gyroscope protocol.

Other contracts, such as the [Reserve](/ireserve), may also need to reference the `IPAMM` interface to obtain pricing information or initiate redemption operations.

Here's an example of how the `IPAMM` interface might be used in the Motherboard contract:

```solidity
function mint(DataTypes.MintAsset[] calldata assets, uint256 minReceivedAmount)
    external
    returns (uint256 mintedGYDAmount)
{
    // Compute the amount of GYD to mint for the given input assets
    mintedGYDAmount = pamm().mint(assets[0].inputAmount, assets[0].inputToken);

    // Ensure the minted amount is at least the minimum requested
    require(mintedGYDAmount >= minReceivedAmount, "Insufficient GYD minted");

    // Mint the GYD tokens to the user
    gydToken().mint(msg.sender, mintedGYDAmount);

    return mintedGYDAmount;
}
```

In this example, the Motherboard contract calls the `mint` function on the `IPAMM` contract to compute the amount of GYD tokens to mint for the given input assets. It then ensures that the minted amount meets the user's minimum requirement, and finally mints the GYD tokens to the user's address.

The redemption process would follow a similar pattern, where the Motherboard contract calls the `redeem` function on the `IPAMM` contract to compute the USD value to be returned for the given GYD token amount.

## Conclusion

The `IPAMM` interface is a crucial component of the Gyroscope protocol, as it encapsulates the core pricing and liquidity management logic. By providing a standardized way for other contracts to interact with the primary AMM, the `IPAMM` interface helps to maintain the overall cohesion and modularity of the Gyroscope system.